---
export const prerender = false
import GenericLayout from "@/layouts/generic.astro"
import useStrapi from "@/utils/strapi"
import ContactForm from "@/components/contactForm/index.astro"
import Blocks from "@/components/blocks/index.astro" 
import Media from "@/components/media/index.astro" 
import Anchor from "@/components/anchor/index.astro"
import DynamicZone from "@/components/dynamicZone/index.astro"
import { Icon } from "astro-icon/components"
const { treatment } = Astro.params

const response = await useStrapi.collection('treatments').find({
    filters: {
        slug: {
            $eq: treatment
        }
    },
    pagination: {
      pageSize: 1,
    },
    populate: {
        thumbnail: {
            populate: '*'
        },
        composites: {
            on: { 
                'composites.cta-section': {
                    populate: "*",
                },
                'composites.generic-content': {
                    populate: "*",
                },
                'composites.accordions': {
                    populate: "*",
                },
                'composites.contact-form': {
                    populate: "*",
                },
                'composites.testimonials': {
                    populate: "*", 
                },
                'composites.card-display': {
                    populate: { 
                        'cards': {
                        populate: "*"
                        }, 
                    }
                }
            },
        }
    }
})

const data = response.data[0]

const { title, excerpt, price, duration, thumbnail, composites, bestFor } = data;

let durationString = '';

if(duration) {
    const [ h, m, s ] = duration.split(":")

    const hours = parseInt(h)
    const mins = parseInt(m) 
    
    if( hours > 1) { 
        durationString += hours > 1 ? `${hours}h  ` : `${hours}h `
    }

    if( mins >= 1 || hours == 1) {
        durationString += hours == 1 ? `60m` : `${mins}m`
    }
}

---

<GenericLayout >  
    <div class="container flex flex-col gap-2 mt-2"> 

        <div class="relative lg:col-span-2 xl:col-span-3 overflow-hidden flex flex-row">
            <Anchor href={"/treatments"} class="flex justify-center items-center gap-1" icon="mdi:arrow-left-thin" label="Back to treatments" />
        </div>

        <div class="relative lg:col-span-2 xl:col-span-3 has-gradient min-h-[200px] md:min-h-[300px] overflow-hidden flex flex-col justify-center items-center text-center p-4 text-white rounded">
            <div class="z-10">
                <h1> {title} </h1>
            </div>
        </div>

        <ul class="relative container flex flex-col md:flex-row items-center my-4 divide-y md:divide-y-0 md:divide-x divide-neutral-light py-3 overflow-hidden *:z-10"> 
            <li class="flex flex-col justify-center items-center gap-0.5 py-3 w-full md:w-1/3"> 
                <span class="flex text-sm md:text-base items-center gap-1"> <Icon name="mdi:clock-outline" class="w-5 h-5"/> Duration </span>
                <span class="text-lg md:text-2xl font-semibold"> {durationString} </span>
            </li>
            <li class="flex flex-col justify-center items-center gap-0.5 py-3 w-full md:w-1/3"> 
                <span class="flex text-sm md:text-base items-center gap-1"> <Icon name="mdi:account-star-outline" class="w-5 h-5"/> Best for </span>
                <span class="text-lg md:text-2xl font-semibold"> {bestFor} </span>
            </li>
            <li class="flex flex-col justify-center items-center gap-0.5 py-3 w-full md:w-1/3"> 
                <span class="flex text-sm md:text-base items-center gap-1"> <Icon name="mdi:tag-outline" class="w-5 h-5"/> Price </span>
                <span class="text-lg md:text-2xl font-semibold"> Â£{price} </span>
            </li>
        </ul>
    </div>

    <DynamicZone composites={composites} />

    <section class="mb-24">
        <div class="container">
            <div class="relative rounded overflow-hidden has-gradient flex flex-col justify-center items-center py-12">
                <div class="z-10 text-white flex flex-col justify-center items-center gap-4 ">
                    <h2> Ready to get started? </h2>
                    <p class="text-xl text-center px-4"> Getting the right treatment that's right for you couldn't be easier. </p> 

                    <Anchor href={"/booking"} variant="primary" label="Book a session"/>
                </div>
                
            </div> 
        </div>
    </section>
</GenericLayout>
