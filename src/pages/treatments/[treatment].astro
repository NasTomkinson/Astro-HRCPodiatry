---
export const prerender = false
import GenericLayout from "@/layouts/generic.astro"
import useStrapi from "@/utils/strapi"
import ContactForm from "@/components/contactForm/index.astro"
import Blocks from "@/components/blocks/index.astro" 
import Media from "@/components/media/index.astro" 
import Anchor from "@/components/anchor/index.astro"
import DynamicZone from "@/components/dynamicZone/index.astro"
import { Icon } from "astro-icon/components"
const { treatment } = Astro.params

const response = await useStrapi.collection('treatments').find({
    filters: {
        slug: {
            $eq: treatment
        }
    },
    pagination: {
      pageSize: 1,
    },
    populate: {
        thumbnail: {
            populate: '*'
        },
        composites: {
            on: { 
                'composites.cta-section': {
                    populate: "*",
                },
                'composites.generic-content': {
                    populate: "*",
                },
                'composites.accordions': {
                    populate: "*",
                },
                'composites.contact-form': {
                    populate: "*",
                },
                'composites.testimonials': {
                    populate: "*", 
                },
                'composites.card-display': {
                    populate: { 
                        'cards': {
                        populate: "*"
                        }, 
                    }
                }
            },
        }
    }
})

const data = response.data[0]

const { title, excerpt, price, duration, thumbnail, composites, bookingUrl } = data;

let durationString = '';

if(duration) {
    const [ h, m, s ] = duration.split(":")

    const hours = parseInt(h)
    const mins = parseInt(m) 
    
    if( hours > 1) {
        durationString += hours > 1 ? `${hours}h ` : `${hours}h `
    }

    if( mins >= 1 || hours == 1) {
        durationString += hours == 1 ? `60m` : `${mins}m`
    }
}

---

<GenericLayout >  
    <div class="container  "> 

        <div class="relative lg:col-span-2 xl:col-span-3 overflow-hidden flex flex-row">
            <Anchor href={"/treatments"} class="flex justify-center items-center gap-1" icon="mdi:arrow-left-thin" label="Back to treatments" />
        </div>

        <div class="relative lg:col-span-2 xl:col-span-3 has-gradient min-h-[300px] overflow-hidden flex flex-col justify-center items-center text-center p-4 text-white rounded">
            <h1 class="z-10"> {title} </h1>
        </div>

        
        </div>

        <!-- <aside class="grid-card lg:col-span-2 xl:col-start-3 xl:row-span-2 p-4 flex flex-col justify-start gap-6">
            <div class="flex flex-col justify-start gap-1">
                <h2 class="text-2xl! lg:text-3xl!"> Get in touch </h2>
                <p> We will aim to get in touch with you within 48 hours. </p>
            </div>
            <ContactForm defaultTreatment={data.title}/> 
        </aside> -->
    </div>

    <DynamicZone composites={composites} />

    <section class="mb-24">
        <div class="container">
            <div class="relative rounded overflow-hidden has-gradient flex flex-col justify-center items-center py-12">
                <div class="z-10 text-white flex flex-col justify-center items-center gap-4 ">
                    <h2> Ready to get started? </h2>
                    <p class="text-xl"> Getting the right treatment that's right for you couldn't be easier. </p>
                    <ul class="flex flex-row justify-center items-center gap-8">
                        {price && (
                            <li class="flex flex-col items-center gap-1">
                                <span class="uppercase text-sm"> Price </span>
                                <span  class="flex items-center gap-1 text-2xl">
                                    <Icon name="mdi:tag-outline" />  Â£{price} 
                                </span>
                            </li>
                        )}
                        { (durationString) && 
                            <li class="flex flex-col items-center gap-1">
                                <span class="uppercase text-sm"> Duration </span>  
                                <span  class="flex items-center gap-1 text-2xl"> 
                                    <Icon name="mdi:clock-outline" /> 
                                    {durationString} 
                                </span>
                            </li>}                         
                    </ul>
 

                    <Anchor href={"/booking"} variant="primary" label="Book a session"/>
                </div>
                
            </div> 
        </div>
    </section>
</GenericLayout>
